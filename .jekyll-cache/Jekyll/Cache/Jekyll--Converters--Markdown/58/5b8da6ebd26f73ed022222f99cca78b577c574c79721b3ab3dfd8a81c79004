I"£<p>This post demonstrates a straightforward method for writing ‚Äúlive‚Äù client-side form validation. It is intended for intermediates or advanced beginners who understand the fundamentals of HTML and modern JavaScript (ES2015). Code samples in this post use ES2015 features and APIs that should be supported in the latest versions of major browsers, but will not work in older browsers.</p>

<h2 id="looking-at-the-requirements">Looking at the Requirements</h2>

<p>Suppose you are asked to build a basic user profile form to collect a person‚Äôs first name, last name, and personal bio. The info will need to be POST-ed to an API when the form is submitted, but not before doing some client-side validation.</p>

<p>Let‚Äôs say this is the mock-up you received from the designer:</p>

<p><img src="http://0.0.0.0:4000/static/images/posts/2018-01-19-form-validation-mockup.png" alt="Form Validation Mock-Up" /></p>

<p>At first glance, it looks like a simple form you‚Äôve built many times before. You figure you‚Äôll just validate the form when ‚ÄòSave‚Äô is clicked and show any errors just like the mock-up. Then you read the written requirements from designer:</p>

<blockquote>
  <h4 id="profile-form-validation">Profile Form Validation</h4>

  <p>For the best possible user experience, the profile form should show which fields are valid or invalid as the user works through the form. That is, form validation should be ‚Äúlive.‚Äù</p>

  <p>This means:</p>

  <ul>
    <li>A field should not show any errors until the user has touched it.</li>
    <li>Once the user touches a field, show an error while the field is not valid.</li>
    <li>Error messages should disappear as soon as the error has been corrected.</li>
    <li>Clicking the ‚ÄòSave‚Äô button should reveal all errors (or submit the form if there are no errors).</li>
  </ul>

  <p>Field validation rules:</p>

  <ul>
    <li>First name - Cannot be blank.</li>
    <li>Last name - Cannot be blank.</li>
    <li>Bio - Cannot be blank, and must contain at least eight words.</li>
  </ul>
</blockquote>

<p>Oh. ‚ÄúLive‚Äù form validation. Perhaps this simple form is not so simple.</p>

<p>To begin with, perhaps you are also a bit confused by the word ‚Äútouched.‚Äù You aren‚Äôt sure what the designer meant by that.</p>

<p>So you go to the designer and talk through the UX with her. You come to understand that a field is ‚Äútouched‚Äù once the user focuses on the field and then moves away from it. You take a look at a list of DOM events and decide that either <code class="language-plaintext highlighter-rouge">onblur</code> or <code class="language-plaintext highlighter-rouge">onfocusout</code> would work for detecting those exit events. So now you have a definition of ‚Äútouched‚Äù that you can work with in code!</p>

<h2 id="lets-write-some-code">Let‚Äôs Write Some Code</h2>

<p>Now that we understand the objective, let‚Äôs think through how to code this. We are certainly going to need some HTML markup for the form. Using the bare minimum markup, here‚Äôs what we get:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"firstName"</span> <span class="na">placeholder=</span><span class="s">"First name"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"lastName"</span> <span class="na">placeholder=</span><span class="s">"Last name"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"bio"</span> <span class="na">placeholder=</span><span class="s">"Bio"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"submit"</span><span class="nt">&gt;</span>Save<span class="nt">&lt;/button&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</code></pre></div></div>

<p>Hopefully you already know that this form will work as written. When the user clicks the ‚ÄòSave‚Äô button or presses the ‚ÄòEnter‚Äô key inside the form, your browser will make a <em>synchronous POST request</em> to the current page URL. By default, the form data will be encoded in the request with the <code class="language-plaintext highlighter-rouge">application/x-www-form-urlencoded</code> content type. The server is then responsible for handling the request and returning a new or updated version of the page.</p>

<p>But‚Ä¶ it‚Äôs 2018, not 1999. Users expect their interfaces to be smarter and more reactive. Let‚Äôs also suppose that this form is part of a single page app, so instead of a <em>synchronous</em> request that refreshes the page, you need to use JavaScript to make an <em>asynchronous</em> POST request that sends this data to an API endpoint encoded as JSON (<code class="language-plaintext highlighter-rouge">application/json</code> content type).</p>

<p>Let‚Äôs say the relative path to the endpoint is <code class="language-plaintext highlighter-rouge">/api/profile</code>. We could add a script to submit the form data asynchronously:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;form</span> <span class="na">onsubmit=</span><span class="s">"handleSubmit(event)"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"firstName"</span> <span class="na">placeholder=</span><span class="s">"First name"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"lastName"</span> <span class="na">placeholder=</span><span class="s">"Last name"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"bio"</span> <span class="na">placeholder=</span><span class="s">"Bio"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"submit"</span><span class="nt">&gt;</span>Save<span class="nt">&lt;/button&gt;</span>
<span class="nt">&lt;/form&gt;</span>

<span class="nt">&lt;script&gt;</span>
  <span class="kd">function</span> <span class="nx">handleSubmit</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>

    <span class="c1">// Get the form, and create an object with the form data</span>
    <span class="kd">const</span> <span class="nx">form</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">firstName</span><span class="p">:</span> <span class="nx">form</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">[name="firstName"]</span><span class="dl">'</span><span class="p">).</span><span class="nx">value</span><span class="p">,</span>
      <span class="na">lastName</span><span class="p">:</span> <span class="nx">form</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">[name="lastName"]</span><span class="dl">'</span><span class="p">).</span><span class="nx">value</span><span class="p">,</span>
      <span class="na">bio</span><span class="p">:</span> <span class="nx">form</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">[name="bio"]</span><span class="dl">'</span><span class="p">).</span><span class="nx">value</span><span class="p">,</span>
    <span class="p">};</span>

    <span class="c1">// Asynchronously post the data</span>
    <span class="nx">fetch</span><span class="p">(</span><span class="dl">"</span><span class="s2">/api/profile</span><span class="dl">"</span><span class="p">,</span> <span class="p">{</span>
      <span class="na">method</span><span class="p">:</span> <span class="dl">"</span><span class="s2">post</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">body</span><span class="p">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">data</span><span class="p">),</span>
    <span class="p">})</span>
      <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
      <span class="p">})</span>
      <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Success!</span>
      <span class="p">});</span>
  <span class="p">}</span>
<span class="nt">&lt;/script&gt;</span>
</code></pre></div></div>

<p>This is pretty straightforward. We added <code class="language-plaintext highlighter-rouge">onsubmit="handleSubmit(event)</code> to the form and wrote the <code class="language-plaintext highlighter-rouge">handleSubmit</code> function to read and POST the form data. We could go into greater depth about how to handle the server response and errors, but that‚Äôs not the focus of this post. We‚Äôre talking about live form validation, so let‚Äôs go back to that.</p>

<h2 id="data-modeling">Data Modeling</h2>

<p>In the above examples, we didn‚Äôt define a data model in JavaScript. Instead, the data was effectively stored in the <code class="language-plaintext highlighter-rouge">input</code> elements, and we could get to it by query-selecting all of the input elements and reading their <code class="language-plaintext highlighter-rouge">.value</code> attributes. In a way, this makes the form like a Plain Old JavaScript Object with the following structure:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">profile</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">firstName</span><span class="p">:</span> <span class="dl">""</span><span class="p">,</span>
  <span class="na">lastName</span><span class="p">:</span> <span class="dl">""</span><span class="p">,</span>
  <span class="na">bio</span><span class="p">:</span> <span class="dl">""</span><span class="p">,</span>
<span class="p">};</span>
</code></pre></div></div>

<p>So this is our ‚Äúdata model‚Äù for the profile, written in JS. And it‚Äôs likely that our API will expect to receive the data in this format, which is what we did in the asynchronous form example above. To make this object, all we had to do was read and copy the values from the form inputs.</p>

<p>But looking back at our requirements, we need to track more than the input values. We also have to track which inputs are ‚Äòtouched‚Äô. But since there is no such thing as <code class="language-plaintext highlighter-rouge">input.touched</code>, we can‚Äôt get this from the DOM in the same way. Instead, we will have to model <code class="language-plaintext highlighter-rouge">input.touched</code> in JavaScript and keep track using DOM events.</p>

<p>We can model which fields were ‚Äòtouched‚Äô by extending our <code class="language-plaintext highlighter-rouge">profile</code> object from above. We can make <code class="language-plaintext highlighter-rouge">firstName</code>, <code class="language-plaintext highlighter-rouge">lastName</code>, and <code class="language-plaintext highlighter-rouge">bio</code> into sub-objects that not only store a value, but can also record whether or not the corresponding <code class="language-plaintext highlighter-rouge">input</code> has been touched:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">profile</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">firstName</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">value</span><span class="p">:</span> <span class="dl">""</span><span class="p">,</span>
    <span class="na">touched</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
  <span class="p">},</span>
  <span class="na">lastName</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">value</span><span class="p">:</span> <span class="dl">""</span><span class="p">,</span>
    <span class="na">touched</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
  <span class="p">},</span>
  <span class="na">bio</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">value</span><span class="p">:</span> <span class="dl">""</span><span class="p">,</span>
    <span class="na">touched</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
  <span class="p">},</span>
<span class="p">};</span>
</code></pre></div></div>

<p>We also need a place to put any errors we find in the profile data, so let‚Äôs also add an ‚Äòerrors‚Äô Array. Further, let‚Äôs wrap both the profile object and errors list in a parent object called ‚Äòstate‚Äô to keep everything grouped together.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">state</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">profile</span><span class="p">:</span> <span class="p">{</span>
    <span class="c1">// ...</span>
  <span class="p">},</span>
  <span class="na">errors</span><span class="p">:</span> <span class="p">[],</span>
<span class="p">};</span>
</code></pre></div></div>

<p>If you are familiar with React or Redux, the idea of putting everything into one big state object might feel familiar. For those familiar with AngularJS: ‚Äòstate‚Äô is similar to ‚Äòscope‚Äô.</p>

<h2 id="syncing-data-data-binding">Syncing Data (Data Binding)</h2>

<p>This looks good, and our data model now includes all of the values we need to track, but when the user interacts with the form, we need a way to keep ‚Äòvalue‚Äô and ‚Äòtouched‚Äô up to date in real time.</p>

<p>Synchronizing the form with our data model is pretty straightforward: every time the form receives an <code class="language-plaintext highlighter-rouge">oninput</code> event, we can read the form data and copy it to our model. Meanwhile, we can listen for the <code class="language-plaintext highlighter-rouge">onfocusout</code>* event to know when a field was touched, since <code class="language-plaintext highlighter-rouge">onfocusout</code> is triggered when the user leaves an input field.</p>

<p>While we <em>could</em> attach event listeners for these events to each input, there‚Äôs no need to do so. Thanks to event bubbling, we only need to put them on the form, like so:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;form</span>
  <span class="na">onsubmit=</span><span class="s">"handleSubmit(event)"</span>
  <span class="na">oninput=</span><span class="s">"handleInput(event)"</span>
  <span class="na">onfocusout=</span><span class="s">"handleFocusOut(event)"</span>
<span class="nt">&gt;</span>
  <span class="c">&lt;!-- ... form inputs --&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</code></pre></div></div>

<p><em>*If you are wondering why we use <code class="language-plaintext highlighter-rouge">onfocusout</code> here instead of <code class="language-plaintext highlighter-rouge">onblur</code>, it is because <code class="language-plaintext highlighter-rouge">onblur</code> does not support event bubbling. Therefor <code class="language-plaintext highlighter-rouge">onblur</code> will only work if you attach the event listener to each input field. In this case, it is simpler to use event bubbling.</em></p>

<p>Let‚Äôs update the event handlers:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">state</span> <span class="o">=</span> <span class="p">{</span>
  <span class="c1">// ...</span>
<span class="p">};</span>

<span class="kd">function</span> <span class="nx">handleSubmit</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">formElem</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">currentTarget</span><span class="p">;</span>

  <span class="c1">// Prevent form from submitting</span>
  <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>

  <span class="c1">// Mark all fields touched</span>
  <span class="nx">state</span><span class="p">.</span><span class="nx">profile</span><span class="p">.</span><span class="nx">firstName</span><span class="p">.</span><span class="nx">touched</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="nx">state</span><span class="p">.</span><span class="nx">profile</span><span class="p">.</span><span class="nx">lastName</span><span class="p">.</span><span class="nx">touched</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="nx">state</span><span class="p">.</span><span class="nx">profile</span><span class="p">.</span><span class="nx">bio</span><span class="p">.</span><span class="nx">touched</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

  <span class="nx">doUpdate</span><span class="p">(</span><span class="nx">formElem</span><span class="p">);</span>

  <span class="c1">// No errors. Save the data.</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">state</span><span class="p">.</span><span class="nx">errors</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// In a real application, this is where we</span>
    <span class="c1">// would make an Ajax call or call or</span>
    <span class="c1">// form.submit() to save the form data.</span>
    <span class="nx">alert</span><span class="p">(</span><span class="dl">"</span><span class="s2">No errors - we can save the data!</span><span class="dl">"</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">handleInput</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Get the form element and update the profile</span>
  <span class="kd">const</span> <span class="nx">formElem</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">currentTarget</span><span class="p">;</span>
  <span class="nx">doUpdate</span><span class="p">(</span><span class="nx">formElem</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">handleFocusOut</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Triggered when the user leaves an input (the input loses focus)</span>
  <span class="c1">// Mark the input 'touched' and update the profile</span>
  <span class="kd">const</span> <span class="nx">formElem</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">currentTarget</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">inputElem</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">field</span> <span class="o">=</span> <span class="nx">profile</span><span class="p">[</span><span class="nx">inputElem</span><span class="p">.</span><span class="nx">name</span><span class="p">];</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">field</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">field</span><span class="p">.</span><span class="nx">touched</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="nx">doUpdate</span><span class="p">(</span><span class="nx">formElem</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">doUpdate</span><span class="p">(</span><span class="nx">formElem</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Read the form data and update the state field values</span>
  <span class="kd">const</span> <span class="p">{</span> <span class="nx">firstName</span><span class="p">,</span> <span class="nx">lastName</span><span class="p">,</span> <span class="nx">bio</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">state</span><span class="p">.</span><span class="nx">profile</span><span class="p">;</span>
  <span class="nx">firstName</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">getInputVal</span><span class="p">(</span><span class="nx">formElem</span><span class="p">,</span> <span class="dl">"</span><span class="s2">firstName</span><span class="dl">"</span><span class="p">);</span>
  <span class="nx">lastName</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">getInputVal</span><span class="p">(</span><span class="nx">formElem</span><span class="p">,</span> <span class="dl">"</span><span class="s2">lastName</span><span class="dl">"</span><span class="p">);</span>
  <span class="nx">bio</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">getInputVal</span><span class="p">(</span><span class="nx">formElem</span><span class="p">,</span> <span class="dl">"</span><span class="s2">bio</span><span class="dl">"</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">getInputVal</span><span class="p">(</span><span class="nx">formElem</span><span class="p">,</span> <span class="nx">inputName</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">formElem</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">`[name="</span><span class="p">${</span><span class="nx">inputName</span><span class="p">}</span><span class="s2">"]`</span><span class="p">).</span><span class="nx">value</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p><em>When using event bubbling, pay attention to the difference between <code class="language-plaintext highlighter-rouge">event.target</code> and <code class="language-plaintext highlighter-rouge">event.currentTarget</code>.</em></p>

<p>Take a moment to trace through the code‚Ä¶ <code class="language-plaintext highlighter-rouge">handleInput</code> will update the profile object every time the form receives input. Meanwhile, <code class="language-plaintext highlighter-rouge">handleFocusOut</code> is triggered whenever the user leaves an input field. It records that the input was touched and also updates the profile data. We‚Äôve also changed the <code class="language-plaintext highlighter-rouge">handleSubmit</code> function to mark all fields as ‚Äòtouched‚Äô and then update the profile data. If there are no errors at this point, it will submit the form ‚Ä¶of course we still haven‚Äôt added any validation at this point.</p>

<p>Finally, <code class="language-plaintext highlighter-rouge">doUpdate</code> (with the help of <code class="language-plaintext highlighter-rouge">getInputVal</code>) is where the form data is actually copied to the profile object. <code class="language-plaintext highlighter-rouge">doUpdate</code> is a separate function so that we don‚Äôt have to duplicate this code inside each event handler. Every event listener calls <code class="language-plaintext highlighter-rouge">doUpdate</code> at some point.</p>

<h2 id="data-flow">Data Flow</h2>

<p>So far we have defined a data model to hold the <strong>state</strong> of our form fields and have written event listeners to keep our data model ‚Äúlive‚Äù and in sync with changes to the form inputs in the interface.</p>

<p>When the user takes action, DOM events trigger our event listeners and begin a feedback loop which reads the form data, validates it, and updates the form accordingly, as illustrated here:</p>

<p><img src="http://0.0.0.0:4000/static/images/posts/2018-01-20-form-validation-data-flow.png" alt="Form Validation Data Flow" /></p>

<p>Two important things about this design are that (a) data updates flow in one direction only and (b) the DOM is always updated all at once at the end of the chain of events‚ÄîNEVER in the middle of the loop.</p>

<p>If this pattern seems unfamiliar to you, I encourage you to go read about <em>data binding</em> and <em>one-way data flow</em>, both extremely important and powerful concepts in modern web interface programming. These are the backbone of reactive frameworks such as React, AngularJS, and VueJS.</p>

<h2 id="complete-the-loop">Complete the Loop</h2>

<p>So we have form events updating our data, but to complete the loop we still need to check for errors and update the form UI, so now let‚Äôs make this interface come alive!</p>

<p>In order for field errors to appear and disappear ‚Äúlive,‚Äù we will need to validate the profile data every time it changes. In our code above, the profile data is <em>always</em> updated inside of the <code class="language-plaintext highlighter-rouge">doUpdate</code> function. So we can modify this function to always validate the profile data and update the ‚Äòerrors‚Äô list after reading the latest form values:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">doUpdate</span><span class="p">(</span><span class="nx">formElem</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Read the form data and update the state</span>
  <span class="c1">// ...</span>

  <span class="c1">// Validate the new profile data and update state.errors</span>
  <span class="nx">state</span><span class="p">.</span><span class="nx">errors</span> <span class="o">=</span> <span class="nx">validateProfile</span><span class="p">(</span><span class="nx">state</span><span class="p">.</span><span class="nx">profile</span><span class="p">);</span>

  <span class="c1">// Render the field errors</span>
  <span class="nx">renderErrors</span><span class="p">(</span><span class="nx">formElem</span><span class="p">,</span> <span class="nx">state</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">validateProfile</span><span class="p">(</span><span class="nx">profile</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">errors</span> <span class="o">=</span> <span class="p">[];</span>

  <span class="c1">// Validate the 'first name' field</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">profile</span><span class="p">.</span><span class="nx">firstName</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">errors</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
      <span class="na">field</span><span class="p">:</span> <span class="dl">"</span><span class="s2">firstName</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">message</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Please enter your first name.</span><span class="dl">"</span><span class="p">,</span>
    <span class="p">});</span>
  <span class="p">}</span>

  <span class="c1">// Validate the 'last name' field</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">profile</span><span class="p">.</span><span class="nx">lastName</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">errors</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
      <span class="na">field</span><span class="p">:</span> <span class="dl">"</span><span class="s2">lastName</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">message</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Please enter your last name.</span><span class="dl">"</span><span class="p">,</span>
    <span class="p">});</span>
  <span class="p">}</span>

  <span class="c1">// Validate the 'bio' field</span>
  <span class="kd">const</span> <span class="nx">requiredWordCount</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">bioWordCount</span> <span class="o">=</span> <span class="nx">profile</span><span class="p">.</span><span class="nx">bio</span><span class="p">.</span><span class="nx">value</span>
    <span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="dl">"</span><span class="s2"> </span><span class="dl">"</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">filter</span><span class="p">((</span><span class="nx">i</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">i</span> <span class="o">!==</span> <span class="dl">""</span><span class="p">).</span><span class="nx">length</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">profile</span><span class="p">.</span><span class="nx">bio</span><span class="p">.</span><span class="nx">value</span> <span class="o">||</span> <span class="nx">bioWordCount</span> <span class="o">&lt;</span> <span class="nx">requiredWordCount</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">wordCountDiff</span> <span class="o">=</span> <span class="nx">requiredWordCount</span> <span class="o">-</span> <span class="nx">bioWordCount</span><span class="p">;</span>
    <span class="nx">errors</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
      <span class="na">field</span><span class="p">:</span> <span class="dl">"</span><span class="s2">bio</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">message</span><span class="p">:</span>
        <span class="s2">`Please write at least </span><span class="p">${</span><span class="nx">wordCountDiff</span><span class="p">}</span><span class="s2"> more word`</span> <span class="o">+</span>
        <span class="p">(</span><span class="nx">wordCountDiff</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="p">?</span> <span class="dl">"</span><span class="s2">s</span><span class="dl">"</span> <span class="p">:</span> <span class="dl">""</span><span class="p">)</span> <span class="o">+</span>
        <span class="dl">"</span><span class="s2">.</span><span class="dl">"</span><span class="p">,</span>
    <span class="p">});</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="nx">errors</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">renderErrors</span><span class="p">(</span><span class="nx">formElem</span><span class="p">,</span> <span class="nx">state</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// First remove any existing error messages</span>
  <span class="kd">const</span> <span class="nx">oldFieldErrors</span> <span class="o">=</span> <span class="nx">formElem</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="dl">"</span><span class="s2">.field-error</span><span class="dl">"</span><span class="p">);</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">err</span> <span class="k">of</span> <span class="nx">oldFieldErrors</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">err</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// Then add any current error messages</span>
  <span class="nx">state</span><span class="p">.</span><span class="nx">errors</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">error</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">field</span> <span class="o">=</span> <span class="nx">state</span><span class="p">.</span><span class="nx">profile</span><span class="p">[</span><span class="nx">error</span><span class="p">.</span><span class="nx">field</span><span class="p">];</span>
    <span class="c1">// Only display errors if the field has been touched.</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">field</span><span class="p">.</span><span class="nx">touched</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">fieldErrorSpan</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">"</span><span class="s2">span</span><span class="dl">"</span><span class="p">);</span>
      <span class="nx">fieldErrorSpan</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="dl">"</span><span class="s2">field-error</span><span class="dl">"</span><span class="p">);</span>
      <span class="nx">fieldErrorSpan</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">;</span>
      <span class="nx">formElem</span>
        <span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">`[name="</span><span class="p">${</span><span class="nx">error</span><span class="p">.</span><span class="nx">field</span><span class="p">}</span><span class="s2">"]`</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">fieldErrorSpan</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">}</span>
</code></pre></div></div>

<p>This is another big chunk of code, but it‚Äôs rather simple. Everything revolves around the <code class="language-plaintext highlighter-rouge">validateProfile</code> function, which simply takes in a profile object, checks each field, and generates a list of errors. To validate more fields, you need only add more checks to this function. Validating first and last name are simple (we‚Äôre just checking that they are not blank), but you might say the validation on the bio field has some extra <em>flair</em>.</p>

<p>The errors generated by <code class="language-plaintext highlighter-rouge">validateProfile</code> are objects in this format:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span>
  <span class="nl">field</span><span class="p">:</span> <span class="nx">fieldName</span><span class="p">,</span>
  <span class="nx">message</span><span class="p">:</span> <span class="nx">errorMessage</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div></div>

<p>With this errors list, we can check if the entire form is valid (<code class="language-plaintext highlighter-rouge">errors.length</code> is 0), and we can also loop over the list of errors to handle each one, which is what <code class="language-plaintext highlighter-rouge">renderErrors</code> does.</p>

<p>One important thing to notice is that we‚Äôve tied everything together by using consistent names throughout. For example, we have <code class="language-plaintext highlighter-rouge">profile.firstName</code> in our state. This same name appears in the error objects and on the corresponding input (ex: <code class="language-plaintext highlighter-rouge">name="firstName"</code>). This makes it easier to keep everything glued together. If instead the input had a different attribute such as <code class="language-plaintext highlighter-rouge">name="first_name"</code>, then we would have to find a way to map <code class="language-plaintext highlighter-rouge">firstName</code> to <code class="language-plaintext highlighter-rouge">first_name</code>, and our code would become rather more complex.</p>

<h2 id="the-final-result">The Final Result</h2>

<p>And with that, our code is complete! Try playing with the form below. It has not been styled, but it should now fulfill all of our designer‚Äôs requirements. Field errors should appear only after you have ‚Äòtouched‚Äô a field, and you should be unable to submit the form, until all fields are valid.</p>

<form onsubmit="handleSubmit(event)" oninput="handleInput(event)" onfocusout="handleFocusOut(event)">
  <div>
    <input type="text" name="firstName" placeholder="First name" />
  </div>

  <div>
    <input type="text" name="lastName" placeholder="Last name" />
  </div>

  <div>
    <textarea name="bio" placeholder="Your bio here"></textarea>
  </div>

<button type="submit">Submit</button>

</form>

<p><a href="http://0.0.0.0:4000/static/js/posts/2018-01-20-form-validation.js"><strong>View the complete code for this example.</strong></a></p>

<h2 id="final-thoughts">Final Thoughts</h2>

<p>Live form validation is a very common requirement of modern web applications, but even in 2018, doing it well is not as simple as it seems. As we‚Äôve seen, the problem also provides a good lead-in for discussing important UI programming concepts like data binding, one-way data flow, pure functional programming, and reactive programming.</p>

<p>The pattern described in this post has served me well a number of times. At its core, you simply pass your data model into a validation function that generates a list of errors. It‚Äôs neither fancy nor clever, but it‚Äôs very effective. Perhaps most importantly, it makes adding and removing form fields easy to do and reason about.</p>

<p>I also felt it was important to do this without using any frameworks, both to make the code easier to follow, and because the raw power of ‚ÄúVanillaJS‚Äù always deserves more attention.</p>

<p>Still, the final code is not as ‚Äúsimple‚Äù as I would like. The messiest bits have to do with DOM manipulation. Without data binding or a templating language, that mess is liable to grow and create bugs as you add more form fields and validation rules.</p>

<p>Lastly, once you understand the fundamental pattern at work here, adapting it to a reactive framework like VueJS is a breeze. This will definitely be the subject of a future post.</p>

<h3 id="additional-challenges">Additional Challenges</h3>

<p>A. (easy) Can you modify the code to disable the ‚ÄòSave‚Äô button whenever the form has invalid fields?</p>

<p>B. (easy) Can you style the form to match the mock-up?</p>

<p>C. (medium) Can you add an email field to the form with validation?</p>

<p>D. (harder) The designer is thrilled that you were able to do the live field validation, and now that they can see it in action, they have a new idea. She asks, ‚ÄúCan we also show which fields are valid? I mean, if a field is ‚Äòtouched‚Äô and ‚Äòvalid‚Äô can we put a check box next to it, just like the error message to show the users it‚Äôs good to go?‚Äù Well, can you?</p>

<script src="http://0.0.0.0:4000/static/js/posts/2018-01-20-form-validation.js"></script>

:ET